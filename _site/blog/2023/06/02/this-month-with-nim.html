<!doctype html>
<html lang="en">
  <head>
  <meta name="charset" content="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="The Nim programming language is a concise, fast programming language that compiles to C, C++ and JavaScript.">
  <meta charset="utf-8">
  <link rel="icon" type="image/png" href="/assets/img/logo_bw.png" />

  
  <title>This Month with Nim: April and May 2023 - Nim Blog</title>
  
  <link rel="stylesheet" href="/assets/css/pure.min.css">
  <link rel="stylesheet" href="/assets/css/pure-grids-responsive.min.css">
  <link href="https://use.fontawesome.com/releases/v5.0.2/css/all.css" rel="stylesheet">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
  
  <link rel="stylesheet" href="/assets/css/highlight/github.css">
  

  <link rel="stylesheet" href="/assets/css/google-fonts.css">
  <link rel="stylesheet" href="/assets/css/main.css?t=1721738524015683587">

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-48159761-1', 'auto');
    ga('send', 'pageview');

  </script>

  <script defer data-domain="nim-lang.org" src="https://plausible.io/js/plausible.js"></script>

  <meta name="twitter:title" content="This Month with Nim: April and May 2023">

  
  <meta name="twitter:description" content="Nuance, Ferus and Gooey">
  <meta property="og:description" content="Nuance, Ferus and Gooey">
  

  <meta name="twitter:site" content="@nim_lang">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://nim-lang.org/assets/img/twitter_banner.png">

  <meta property="og:title" content="This Month with Nim: April and May 2023" />
  <meta property="og:site_name" content="Nim Programming Language" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://nim-lang.org/assets/img/twitter_banner.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="1000" />
  <meta property="og:image:height" content="500" />
  <meta property="og:image:alt" content="Nim Programming Language" />
</head>

  <body class="site">
    <header>
  <nav class="pure-menu pure-menu-horizontal pure-menu-scrollable">
    <div class="nav-content">
      <a href="/" class="pure-menu-heading pure-menu-link site-logo-container">
        <img class="site-logo" src="/assets/img/logo.svg" height="28" alt="Nim">
      </a>
      <ul class="pure-menu-list">
        
        <li class="pure-menu-item">
          <a href="/blog.html"
             class="pure-menu-link current">
            Blog
          </a>
        </li>
        
        <li class="pure-menu-item">
          <a href="/features.html"
             class="pure-menu-link ">
            Features
          </a>
        </li>
        
        <li class="pure-menu-item">
          <a href="/install.html"
             class="pure-menu-link ">
            Download
          </a>
        </li>
        
        <li class="pure-menu-item">
          <a href="/documentation.html"
             class="pure-menu-link ">
            Documentation
          </a>
        </li>
        
        <li class="pure-menu-item">
          <a href="https://forum.nim-lang.org"
             class="pure-menu-link ">
            Forum
          </a>
        </li>
        
        <li class="pure-menu-item">
          <a href="/donate.html"
             class="pure-menu-link ">
            Donate
          </a>
        </li>
        
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://github.com/nim-lang/Nim">Source</a>
        </li>
      </ul>
    </div>
    <div class="menu-fade"></div>
  </nav>
</header>

    <div class="site-content post-page">
      <div class="content">
        <div class="width-reduced">
          <h1 class="post-title">
            This Month with Nim: April and May 2023
          </h1>
          <h3 class="post-meta">
            <span>
              <i class="far fa-calendar-alt" aria-hidden="true"></i>
              02 June 2023
            </span>
            
            <span>
              <i class="fa fa-user-circle" aria-hidden="true"></i>
              The Nim Community
            </span>
            
          </h3>
          <h2 id="nuance"><a href="https://github.com/metagn/nuance">Nuance</a></h2>

<h4 id="author-metagn">Author: <a href="https://github.com/metagn">metagn</a></h4>

<p><a href="https://github.com/metagn/nuance">nuance</a> is a library that provides:</p>
<ul>
  <li>Runtime-compatible types to represent Nim (untyped) AST including filename, line and column information.</li>
  <li>Serialization of these types into an S-expression format that can be directly inserted inside a Nim triple-quoted string.</li>
  <li>Deserialization to these types that works in the compile-time VM.</li>
  <li>Conversion from these types into the compile-time NimNode type that can be used in macros.</li>
</ul>

<p>This allows complex systems that generate Nim code to do it in a much faster and easier way than the current alternatives (making all code run only in the compile-time VM, generating it as raw text, interfacing with the compiler codebase etc.).
Examples of use cases may be templating engines, alternative parsers etc.</p>

<p>As a demonstration of what we can do, <a href="https://github.com/metagn/lispnim">lispnim</a> is a rudimentary version of Lisp that directly maps to Nim code using this library.
<a href="https://github.com/metagn/lispnimgen">lispnimgen</a> is a simple binary Nimble package that generates Nim files from lispnim files, in the sense that the Nim file loads the serialized version at compile-time.
<a href="https://github.com/metagn/lispnimgentest">lispnimgentest</a> is a demonstration of how one can write a Nimble package in lispnim, then generate the Nim files in the installation process of the package.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># testpkg/src/testpkg.lispnim

(proc (foo *) ((x y int) int) (do
  (= result (* x y))
  (if (&lt; result 0)
    (raise (newException ValueError "result cannot be negative")))))
</code></pre></div></div>

<p>Â </p>

<div class="language-nim highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># testpkg/testpkg.nimble</span>

<span class="p">...</span>
<span class="n">requires</span> <span class="s">"https://github.com/metagn/lispnimgen"</span>

<span class="k">import</span> <span class="n">os</span><span class="p">,</span> <span class="n">strutils</span>
<span class="n">after</span> <span class="n">install</span><span class="p">:</span>
  <span class="k">let</span> <span class="n">lispnimgenPath</span> <span class="o">=</span> <span class="n">strip</span> <span class="s">staticExec"nimble path lispnimgen"</span>
  <span class="k">let</span> <span class="n">exePath</span> <span class="o">=</span> <span class="n">lispnimgenPath</span> <span class="o">/</span> <span class="s">"lispnimgen"</span>
  <span class="c"># run lispnimgen on install path</span>
  <span class="n">exec</span> <span class="n">quoteShellCommand</span><span class="p">(</span><span class="o">[</span><span class="n">exePath</span><span class="p">,</span> <span class="n">getPkgDir</span><span class="p">()</span><span class="o">]</span><span class="p">)</span>
</code></pre></div></div>

<p>Installing <code class="language-plaintext highlighter-rouge">testpkg</code> will generate a Nim file in its path like:</p>

<div class="language-nim highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># testpkg.nim</span>
<span class="k">import</span> <span class="n">nuance</span><span class="o">/[</span><span class="n">fromsexp</span><span class="p">,</span> <span class="n">comptime</span><span class="o">]</span>

<span class="n">load</span><span class="p">(</span><span class="n">parseSexp</span><span class="p">(</span><span class="s">"""&lt;serialized ast of testpkg.lispnim&gt;"""</span><span class="p">))</span>
</code></pre></div></div>

<p>We can then import and use this module:</p>

<div class="language-nim highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="n">testpkg</span>
<span class="c"># or</span>
<span class="k">import</span> <span class="n">pkg</span><span class="o">/</span><span class="n">testpkg</span>

<span class="n">echo</span> <span class="n">foo</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">echo</span> <span class="n">foo</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">)</span>
</code></pre></div></div>

<p>Using <code class="language-plaintext highlighter-rouge">--excessiveStackTrace:off</code>, we get the output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>21
main.nim(4)              cmdfile
testpkg.lispnim(5)       foo
Error: unhandled exception: result cannot be negative [ValueError]
</code></pre></div></div>

<p>We can see that the file and line information has been kept for errors.
Note that this is only possible because of the <a href="https://github.com/nim-lang/Nim/pull/21153">macros.setLineInfo proc</a> which exists in Nim version 1.6.12 or higher,
meaning custom information will not persist on older versions.</p>

<p>A binary serialization option may be added in the future for faster deserializing at compile time,</p>

<p>All linked libraries are tested on the C, JavaScript and NimScript backends.
The NimScript backend means that they all work on the compile-time VM as well.</p>

<h2 id="ferus-and-ferushtml">Ferus and FerusHTML</h2>

<h4 id="author-xtrayambak">Author: <a href="https://github.com/xTrayambak">xTrayambak</a></h4>

<p><a href="https://github.com/xTrayambak/ferus">Ferus</a> is a web engine/browser written in Nim.
It aims to be fast, compliant and secure. It doesnât do much yet, it simply does HTML/CSS parsing, it also has an IPC layer written using reliable UDP (netty), a sandboxed rendering model (rendering is not done on the main process), an incomplete DOM implementation and an experimental layout engine is being worked on.
All of this is done within 2.1k lines of code. My future plans include:</p>

<ul>
  <li>a rewrite of Bellardâs QuickJS in Nim, possibly with JIT compilation</li>
  <li>a fully functional layout engine with support for all HTML tags</li>
  <li>more speed improvements (particularly in the IPC layer)</li>
  <li>full WHATWG compliance</li>
  <li>developer tools</li>
  <li>builtin adblocker/anti-fingerprinter</li>
  <li>embeddable API that abstracts the underlying engine from the main browser itself (like Chromium Embedded Framework or GeckoView)</li>
  <li>Manifest V2/V3 support</li>
  <li>hardware accelerated video decode</li>
  <li>fast 3D graphics (WebGL)</li>
</ul>

<p>Now, let us talk about Ferusâ other component: ferushtml.
<a href="https://github.com/xTrayambak/ferushtml">FerusHTML</a> is a safe, fast and (somewhat) compliant HTML parser that is still being worked on.
It uses a finite-state-motion based parser but we intend to add a consume based parser soon.
It is <em>somewhat</em> fast, it can parse a simple HTML document within 0.1415580014387766 ms,
and it also has a utility for dumping a HTMLElement to show itâs children in a neatly organized manner.
It doesnât support attributes yet, but that is the top priority as of right now.</p>

<p>Here is the basic API:</p>
<div class="language-nim highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="n">ferushtml</span>

<span class="k">let</span> <span class="n">mySource</span> <span class="o">=</span> <span class="s">"""
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Hello ferushtml!&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;p1&gt;This is rather plain.&lt;/p1&gt;
    &lt;/body&gt;
&lt;/html&gt;
"""</span>

<span class="c"># Create a parser</span>
<span class="k">var</span> <span class="n">myParser</span> <span class="o">=</span> <span class="n">newHTMLParser</span><span class="p">()</span>

<span class="c"># Parse the HTML source</span>
<span class="k">var</span> <span class="n">res</span> <span class="o">=</span> <span class="n">myParser</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">mySource</span><span class="p">)</span>

<span class="c"># Dump the source to stdout in a neat tree like manner</span>
<span class="n">echo</span> <span class="n">res</span><span class="p">.</span><span class="n">dump</span><span class="p">()</span>
</code></pre></div></div>

<p>Compile the code with <code class="language-plaintext highlighter-rouge">--threads:on</code>, and we get this:
<img src="https://github.com/beef331/website/assets/59499552/fab11063-99cd-411e-94ee-9a38269f9694" alt="image" /></p>

<p>You can now time how fast the executable is,
or you can check out the benchmark test inside ferushtml tests!</p>

<p>If you are interested in this project,
I would appreciate some help.</p>

<h2 id="gooey"><a href="https://github.com/beef331/gooey/">gooey</a></h2>

<h4 id="author-jason-beetham">Author: <a href="https://github.com/beef331/">Jason Beetham</a></h4>

<p>Gooey is very hard to describe GUI tool.
It is mostly for my game framework, but it is a renderer and vector agnostic framework.
In theory one could use it for any place such as TUI, embedded, or its main purpose games.</p>

<p>To declare an element one needs to define a few procedures:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">upload</code> this sends the UI to its target. In my SDL implementation it blits to the screen. In my game framework implementation it adds the UI to a render queue.</li>
  <li><code class="language-plaintext highlighter-rouge">interact</code> this controls interaction, there are a few base procedures that Gooey knows how to call(<code class="language-plaintext highlighter-rouge">onEnter</code>, <code class="language-plaintext highlighter-rouge">onClick</code>, <code class="language-plaintext highlighter-rouge">onHover</code>, <code class="language-plaintext highlighter-rouge">onDrag</code>, <code class="language-plaintext highlighter-rouge">onExit</code>, <code class="language-plaintext highlighter-rouge">onTextInput</code>). More are soon to follow. Enabling more usable widgets.</li>
  <li><code class="language-plaintext highlighter-rouge">layout</code> this controls how and where to draw this element using information it has stored.</li>
</ul>

<p>For instance Gooey has a <code class="language-plaintext highlighter-rouge">buttons</code> module that implements the base required for a Button:</p>
<div class="language-nim highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="n">gooey</span><span class="p">,</span> <span class="n">mathtypes</span>

<span class="k">type</span> <span class="n">ButtonBase</span><span class="o">*[</span><span class="n">Base</span><span class="o">]</span> <span class="o">=</span> <span class="k">ref</span> <span class="k">object</span> <span class="k">of</span> <span class="n">Base</span>
  <span class="n">clickCb</span><span class="o">*</span><span class="p">:</span> <span class="k">proc</span><span class="p">()</span>

<span class="k">proc </span><span class="nf">layout</span><span class="o">*[</span><span class="n">Base</span><span class="o">]</span><span class="p">(</span><span class="n">button</span><span class="p">:</span> <span class="n">ButtonBase</span><span class="o">[</span><span class="n">Base</span><span class="o">]</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Base</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="n">Vec3</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">UiState</span><span class="p">)</span> <span class="o">=</span>
  <span class="k">mixin</span> <span class="n">layout</span>
  <span class="n">Base</span><span class="p">(</span><span class="n">button</span><span class="p">).</span><span class="n">layout</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

<span class="k">proc </span><span class="nf">onClick</span><span class="o">*[</span><span class="n">Base</span><span class="o">]</span><span class="p">(</span><span class="n">button</span><span class="p">:</span> <span class="n">ButtonBase</span><span class="o">[</span><span class="n">Base</span><span class="o">]</span><span class="p">,</span> <span class="n">uiState</span><span class="p">:</span> <span class="k">var</span> <span class="n">UiState</span><span class="p">)</span> <span class="o">=</span>
  <span class="k">if</span> <span class="n">button</span><span class="p">.</span><span class="n">clickCb</span> <span class="o">!=</span> <span class="k">nil</span><span class="p">:</span>
    <span class="n">button</span><span class="p">.</span><span class="n">clickCb</span><span class="p">()</span>
</code></pre></div></div>

<p>To use this in my SDL implementation I do:</p>
<div class="language-nim highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span>
  <span class="n">Button</span> <span class="o">=</span> <span class="k">ref</span> <span class="k">object</span> <span class="k">of</span> <span class="n">ButtonBase</span><span class="o">[</span><span class="n">Element</span><span class="o">]</span>
    <span class="n">baseColor</span><span class="p">:</span> <span class="n">Color</span>
    <span class="n">hoveredColor</span><span class="p">:</span> <span class="n">Color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">127</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="n">button</span><span class="p">:</span> <span class="n">Label</span>

<span class="k">proc </span><span class="nf">upload</span><span class="p">(</span><span class="n">button</span><span class="p">:</span> <span class="n">Button</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">UiState</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="k">var</span> <span class="n">RenderTarget</span><span class="p">)</span> <span class="o">=</span>
  <span class="n">Element</span><span class="p">(</span><span class="n">button</span><span class="p">).</span><span class="n">upload</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">button</span><span class="p">.</span><span class="n">label</span> <span class="o">!=</span> <span class="k">nil</span><span class="p">:</span>
    <span class="n">button</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">upload</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

<span class="k">proc </span><span class="nf">layout</span><span class="p">(</span><span class="n">button</span><span class="p">:</span> <span class="n">Button</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="n">Vec3</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">UiState</span><span class="p">)</span> <span class="o">=</span>
  <span class="n">buttons</span><span class="p">.</span><span class="n">layout</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">button</span><span class="p">.</span><span class="n">label</span> <span class="o">!=</span> <span class="k">nil</span><span class="p">:</span>
    <span class="n">button</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">button</span><span class="p">.</span><span class="n">size</span>
    <span class="n">button</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">layout</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="n">f</span><span class="p">),</span> <span class="n">state</span><span class="p">)</span>

<span class="k">proc </span><span class="nf">onEnter</span><span class="p">(</span><span class="n">button</span><span class="p">:</span> <span class="n">Button</span><span class="p">,</span> <span class="n">uiState</span><span class="p">:</span> <span class="k">var</span> <span class="n">UiState</span><span class="p">)</span> <span class="o">=</span>
  <span class="n">button</span><span class="p">.</span><span class="n">flags</span><span class="p">.</span><span class="n">incl</span> <span class="p">{</span><span class="n">hovered</span><span class="p">}</span>
  <span class="n">button</span><span class="p">.</span><span class="n">baseColor</span> <span class="o">=</span> <span class="n">button</span><span class="p">.</span><span class="n">color</span>
  <span class="n">button</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">button</span><span class="p">.</span><span class="n">hoveredColor</span>

<span class="k">proc </span><span class="nf">onExit</span><span class="p">(</span><span class="n">button</span><span class="p">:</span> <span class="n">Button</span><span class="p">,</span> <span class="n">uiState</span><span class="p">:</span> <span class="k">var</span> <span class="n">UiState</span><span class="p">)</span> <span class="o">=</span>
  <span class="n">button</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">button</span><span class="p">.</span><span class="n">baseColor</span>

<span class="k">proc </span><span class="nf">onClick</span><span class="p">(</span><span class="n">button</span><span class="p">:</span> <span class="n">Button</span><span class="p">,</span> <span class="n">uiState</span><span class="p">:</span> <span class="k">var</span> <span class="n">UiState</span><span class="p">)</span> <span class="o">=</span> <span class="n">buttons</span><span class="p">.</span><span class="n">onClick</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="n">uiState</span><span class="p">)</span>
</code></pre></div></div>

<p>With all of that one is now capable of using a Button assuming they did everything properly.</p>

<p>A full implementation is visible <a href="https://github.com/beef331/gooey/blob/master/example/sdlimpl.nim">here</a>.</p>

<p>This is a rapidly developing UI system that will change depending on my needs and wants.</p>

<hr />

<h2 id="want-to-see-your-project-here-next-month">Want to see your project here next month?</h2>

<p><a href="https://github.com/beef331/website#adding-your-project-to-month-with-nim">Follow this</a>
to add your project to the next monthâs blog post.</p>

        </div>
      </div>
    </div>
    <footer>
  <section class="content">
    <div class="pure-g">
      <div class="copyright pure-u-2-3">
        <p>
          Unless otherwise stated, the content of this page is
          licensed under the
          <a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0</a>
          license.
          Code displayed on this website is MIT licensed.
        </p>
        <p>
          This website is available on
          <a href="https://github.com/nim-lang/website">GitHub</a>
          and contributions are welcome.
          Original website design by
          <a href="https://github.com/dom96">Dominik Picheta</a> and
          <a href="https://github.com/Calinou">Hugo Locurcio</a>.
          Logo by <a href="https://github.com/josephwecker">Joseph Wecker</a>.
        </p>
      </div>
      <div class="pure-u-1-3 right-center">
        <a href="https://m.do.co/c/637ab907c7f4"><img src="/assets/img/do.png"/></a>
      </div>
    </div>
  </section>

</footer>
<script>
    (function(){
      function setTracking(a) {
        var url = a.href;
        a.onclick = function() {
          if (typeof(ga) !== "undefined") {
            ga('send', 'event', 'outbound', 'click', url, {
              'transport': 'beacon',
              'hitCallback': function(){document.location = url;}
            });
          }
        };
      }

      var a = document.getElementsByTagName("a");
      for (var i = 0; i < a.length; ++i) {
        if (a[i].hostname != location.hostname &&
            a[i].getAttribute("target") !== "_blank"
        ) {
          setTracking(a[i])
        }
      }
    })();
</script>

  </div>
  </body>
</html>
